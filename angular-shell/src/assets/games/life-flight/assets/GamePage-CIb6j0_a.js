import{r as n,j as s,u as W,a as $}from"./index-CZsPWhM9.js";import{C as q,F as K,B as Z,a as c,b as x,G as J,M as Q,c as ee,R as te,S as se,P as ne,d as g,e as H,f as Y,g as N,H as X,h as V,i as ae,j as le,k as F,l as re}from"./gameConstants-CqgX2NIO.js";const oe=""+new URL("background-day-DZpyCXUD.png",import.meta.url).href,R=(l,f)=>Math.random()*(f-l)+l;function ie(){return{x:Z,y:c/2,vy:0,rotation:0}}function fe(l){return{x:l??R(0,x),y:R(40,c*.5),speed:R(le,ae),w:R(60,110),h:R(28,48),opacity:R(.18,.42)}}function ce(l){const f=R(80,c-V-N-80),u=X[l%X.length];return{x:x+10,topH:f,bottomY:f+V,passed:!1,hurdle:u,badgeVisible:!1}}function de({isActive:l,gameStarted:f,onScorePoint:u,onHit:E}){const h=n.useRef(null),p=n.useRef(null),b=n.useRef(null),S=n.useRef(0),C=n.useRef(null);n.useEffect(()=>{const e=new Image;e.src=oe,e.onload=()=>{C.current=e}},[]);const[j,A]=n.useState(null),[v,P]=n.useState(null),w=n.useRef(0),z=n.useRef(0),k=n.useRef(l);n.useEffect(()=>{k.current=l},[l]);const I=n.useRef(u),_=n.useRef(E);n.useEffect(()=>{I.current=u},[u]),n.useEffect(()=>{_.current=E},[E]);const D=n.useCallback(()=>{const e=Array.from({length:q},(t,d)=>fe(R(0,x)));p.current={bird:ie(),pipes:[],clouds:e,hurdleIndex:0},w.current=0,z.current=0,S.current=0,A(null),P(null)},[]),G=n.useCallback(()=>{p.current&&(p.current.bird.vy=K)},[]),L=(e,t)=>{e.save(),e.globalAlpha=t.opacity,e.fillStyle="#ffffff",e.beginPath(),e.ellipse(t.x,t.y,t.w/2,t.h/2,0,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(t.x-t.w*.25,t.y+4,t.w*.35,t.h*.4,0,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(t.x+t.w*.25,t.y+4,t.w*.3,t.h*.38,0,0,Math.PI*2),e.fill(),e.restore()},M=(e,t)=>{const{color:d}=t.hurdle,a=d+"dd",r=e.createLinearGradient(t.x,0,t.x+g,0);r.addColorStop(0,d+"cc"),r.addColorStop(.4,d),r.addColorStop(1,d+"88"),e.fillStyle=r,e.fillRect(t.x,0,g,t.topH),e.fillStyle=a,e.fillRect(t.x-4,t.topH-18,g+8,18);const m=e.createLinearGradient(t.x,0,t.x+g,0);m.addColorStop(0,d+"cc"),m.addColorStop(.4,d),m.addColorStop(1,d+"88"),e.fillStyle=m,e.fillRect(t.x,t.bottomY,g,c-t.bottomY-N),e.fillStyle=a,e.fillRect(t.x-4,t.bottomY,g+8,18),e.save(),e.font="900 16px Inter, sans-serif",e.fillStyle="#ffffff",e.textAlign="center",e.globalAlpha=1,e.translate(t.x+g/2,t.topH/2),e.rotate(-Math.PI/2),e.fillText(t.hurdle.name,0,5),e.restore(),e.save(),e.font="900 16px Inter, sans-serif",e.fillStyle="#ffffff",e.textAlign="center",e.globalAlpha=1;const o=c-t.bottomY-N;e.translate(t.x+g/2,t.bottomY+o/2),e.rotate(-Math.PI/2),e.fillText(t.hurdle.name,0,5),e.restore()},O=(e,t)=>{e.save(),e.translate(t.x,t.y),e.rotate(t.rotation),e.beginPath(),e.ellipse(0,0,18,14,0,0,Math.PI*2),e.fillStyle="#FFD166",e.fill(),e.strokeStyle="#F4A261",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(7,-4,4,0,Math.PI*2),e.fillStyle="#fff",e.fill(),e.beginPath(),e.arc(8,-4,2,0,Math.PI*2),e.fillStyle="#1D3557",e.fill(),e.beginPath(),e.moveTo(16,-1),e.lineTo(22,2),e.lineTo(16,5),e.closePath(),e.fillStyle="#E76F51",e.fill(),e.font="10px sans-serif",e.fillText("ðŸ›¡ï¸",-6,5),e.restore()},T=e=>{const t=e.createLinearGradient(0,c-N,0,c);t.addColorStop(0,"#1B4332"),t.addColorStop(1,"#081C15"),e.fillStyle=t,e.fillRect(0,c-N,x,N),e.fillStyle="#2DC653",e.fillRect(0,c-N,x,4)},B=e=>{if(C.current)e.drawImage(C.current,0,0,x,c);else{const t=e.createLinearGradient(0,0,0,c);t.addColorStop(0,"#0A2540"),t.addColorStop(.5,"#023E8A"),t.addColorStop(1,"#0096C7"),e.fillStyle=t,e.fillRect(0,0,x,c)}};return n.useEffect(()=>{if(!l){b.current&&cancelAnimationFrame(b.current);return}D();const e=h.current;if(!e)return;const t=e.getContext("2d",{alpha:!1}),d=()=>{if(!k.current)return;const a=p.current;if(a.clouds.forEach(r=>{r.x-=r.speed,r.x+r.w/2<0&&(r.x=x+r.w/2,r.y=R(40,c*.5))}),!f)a.bird.y+=Math.sin(Date.now()/200)*.8,a.bird.rotation=0;else{a.bird.vy+=J,a.bird.y+=a.bird.vy,a.bird.rotation=Math.max(Q,Math.min(ee,a.bird.vy*te));const r=a.pipes[a.pipes.length-1];if(!r||r.x<x-se){const o=ce(a.hurdleIndex++);a.pipes.push(o),A(o.hurdle)}a.pipes.forEach(o=>{o.x-=ne}),a.pipes=a.pipes.filter(o=>o.x+g>-10);let m=null;for(const o of a.pipes){if(a.bird.x+H>o.x&&a.bird.x-H<o.x+g&&(a.bird.y-H<o.topH||a.bird.y+H>o.bottomY)){m=o;break}!o.passed&&o.x+g<a.bird.x-H&&(o.passed=!0,w.current+=1,I.current(w.current),Y[w.current]&&(P(Y[w.current]),setTimeout(()=>P(null),2900)))}if(m||a.bird.y+17>c-N||a.bird.y-17<0){_.current(m?m.hurdle:null);return}}B(t),a.clouds.forEach(r=>L(t,r)),a.pipes.forEach(r=>M(t,r)),T(t),O(t,a.bird),b.current=requestAnimationFrame(d)};return b.current=requestAnimationFrame(d),()=>{b.current&&cancelAnimationFrame(b.current)}},[l,f,D]),{canvasRef:h,handleFlap:G,currentHurdle:j,microMsg:v}}function ue({hurdle:l,livesLeft:f,onRetry:u}){return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none",style:{background:"rgba(230,57,70,0.15)"}}),s.jsx("div",{className:"absolute inset-0 z-40 flex items-center justify-center px-5",children:s.jsxs("div",{className:"w-full max-w-sm slide-up",style:{background:"#ffffff",borderRadius:20,padding:"24px 20px",boxShadow:"0 -4px 40px rgba(230,57,70,0.25), 0 20px 60px rgba(0,0,0,0.4)"},children:[s.jsxs("div",{className:"rounded-xl px-4 py-3 mb-4 flex items-center gap-3",style:{background:l?l.color+"18":"#E6394618",border:`1.5px solid ${l?l.color:"#E63946"}44`},children:[s.jsx("span",{style:{fontSize:28},children:"ðŸ’¥"}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-black",style:{fontSize:16,color:(l==null?void 0:l.color)||"#E63946"},children:["You hit ",(l==null?void 0:l.name)||"a Hurdle"]}),s.jsx("p",{className:"font-semibold",style:{fontSize:12,color:"#6B7280"},children:(l==null?void 0:l.cost)||""})]})]}),s.jsx("p",{className:"mb-5 leading-relaxed",style:{fontSize:14,color:"#374151"},children:(l==null?void 0:l.hitMessage)||"A financial hurdle hit your family hard."}),s.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[s.jsx("span",{style:{fontSize:13,color:"#6B7280",fontWeight:500},children:"Lives left:"}),s.jsx("div",{className:"flex gap-1",children:Array.from({length:3}).map((E,h)=>s.jsx("span",{style:{fontSize:18},children:h<f?"â¤ï¸":"ðŸ–¤"},h))}),f===1&&s.jsx("span",{className:"ml-1 font-semibold",style:{fontSize:12,color:"#E63946"},children:"Last chance!"})]}),s.jsx("button",{onClick:u,className:"w-full py-4 rounded-2xl font-bold text-white transition-all active:scale-95",style:{fontSize:16,background:"linear-gradient(135deg, #023E8A 0%, #0096C7 100%)",boxShadow:"0 6px 20px rgba(2,62,138,0.35)"},children:"Keep Flying"}),s.jsx("p",{className:"text-center mt-3",style:{fontSize:12,color:"#9CA3AF"},children:"Insurance could have absorbed this blow."})]})})]})}function he(){const{state:l,dispatch:f,ACTIONS:u,PHASES:E}=W(),h=$(),[p,b]=n.useState(!1),[S,C]=n.useState(!1),[j,A]=n.useState(3),[v,P]=n.useState(!1),[w,z]=n.useState(null),[k,I]=n.useState(0),[_,D]=n.useState(F),[G,L]=n.useState(!1),M=n.useRef(F),O=n.useRef(0),T=n.useRef(!1);n.useEffect(()=>{l.phase===E.GAMEOVER?h("/gameover"):l.phase===E.LANDING&&h("/")},[l.phase,h,E]),n.useEffect(()=>(M.current=F,O.current=0,D(F),I(0),b(!0),C(!1),A(3),()=>b(!1)),[]);const B=n.useCallback(i=>{O.current=i,I(i),f({type:u.ADD_SCORE})},[f,u]),e=n.useCallback(i=>{if(T.current)return;T.current=!0,b(!1),z(i),L(!0),setTimeout(()=>L(!1),200);const y=M.current-1;M.current=y,D(y),f({type:u.LOSE_LIFE}),y<=0?setTimeout(()=>h("/gameover"),800):P(!0)},[f,u,h]),t=n.useCallback(()=>{P(!1),z(null),T.current=!1,C(!1),A(3),setTimeout(()=>b(!0),100)},[]),{canvasRef:d,handleFlap:a,currentHurdle:r,microMsg:m}=de({isActive:p,gameStarted:S,onScorePoint:B,onHit:e});n.useEffect(()=>{let i;return p&&!S&&!v&&(j>0?i=setTimeout(()=>A(y=>y-1),1e3):j===0&&(C(!0),a())),()=>clearTimeout(i)},[p,S,j,v,a]);const o=Math.min(Math.round(k/re*100),100),U=n.useCallback(i=>{i&&i.type,!v&&p&&S&&a()},[v,p,S,a]);return n.useEffect(()=>{const i=y=>{y.code==="Space"&&(y.preventDefault(),U())};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[U]),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-start overflow-hidden",style:{background:"#0A2540",touchAction:"none"},onPointerDown:U,children:[s.jsx("div",{className:`absolute inset-0 ${S?"opacity-100":"opacity-80"} transition-opacity pointer-events-none`,children:s.jsx("canvas",{ref:d,width:x,height:c,className:"w-full h-full object-fill block"})}),!S&&!v&&p&&s.jsx("div",{className:"absolute inset-0 z-30 flex flex-col items-center justify-center bg-black/40 backdrop-blur-sm pointer-events-none",children:s.jsx("div",{className:"text-white font-black text-9xl drop-shadow-[0_8px_16px_rgba(0,0,0,0.8)] animate-[ping_1s_ease-out_reverse]",style:{textShadow:"0 4px 15px rgba(255,140,0,0.8)"},children:j>0?j:"FLY!"},j)}),s.jsx("div",{className:`absolute bottom-0 left-0 right-0 z-20 px-4 pb-6 pt-3 ${G?"screen-shake":""}`,style:{background:"rgba(0,0,0,0.5)",backdropFilter:"blur(8px)",borderTop:"1px solid rgba(255,255,255,0.15)",pointerEvents:"none"},children:s.jsxs("div",{style:{pointerEvents:"auto"},onClick:i=>i.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"font-black tracking-widest",style:{fontSize:10,color:"#90E0EF",textTransform:"uppercase",letterSpacing:"0.18em",opacity:.9},children:"PREPAREDNESS SCORE"}),s.jsx("div",{className:"flex gap-1",children:Array.from({length:F}).map((i,y)=>s.jsx("span",{style:{fontSize:22},children:y<_?"â¤ï¸":"ðŸ–¤"},y))})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-baseline gap-3",children:[s.jsx("span",{className:"font-black",style:{fontSize:42,color:"#ffffff",lineHeight:1},children:k}),s.jsxs("span",{className:"font-black uppercase",style:{fontSize:14,color:"#00B4D8"},children:[o,"% Prepared"]})]}),r&&s.jsx("div",{className:"badge-pop",children:s.jsxs("div",{className:"rounded-lg px-3 py-1.5 flex items-center gap-2",style:{background:r.color+"33",border:`1px solid ${r.color}77`},children:[s.jsx("div",{className:"rounded-full",style:{width:6,height:6,background:r.color}}),s.jsx("span",{className:"font-black uppercase",style:{fontSize:10,color:r.color},children:r.name})]})})]})]})}),m&&s.jsx("div",{className:"absolute bottom-32 left-0 right-0 flex justify-center z-20 pointer-events-none",children:s.jsx("div",{className:"fade-in-out rounded-2xl px-5 py-3",style:{background:"rgba(0,180,216,0.25)",border:"1px solid rgba(0,180,216,0.5)",backdropFilter:"blur(12px)"},children:s.jsx("p",{className:"font-semibold text-center text-white",style:{fontSize:14},children:m})})}),p&&S&&k===0&&!v&&s.jsx("div",{className:"absolute bottom-40 left-0 right-0 flex justify-center z-20 pointer-events-none",children:s.jsx("p",{className:"font-medium animate-pulse text-white/60",style:{fontSize:14},children:"ðŸ‘† Tap to fly!"})}),v&&w&&s.jsx(ue,{hurdle:w,livesLeft:_,onRetry:t})]})}export{he as default};
